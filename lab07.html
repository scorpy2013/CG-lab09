<html>
<head>
    <meta charset="UTF-8">
    <p> _______________________________________________________________</p>
       ||----------------------------ПОСТРОЕНИЕ ЛИНИИ БЕЗЬЕ------------------------||</p>
       |-------------------------ЛКМ*3 => построение 2-ух линий-------------------------|</p>
       ||------------------------последнее нажатие => линия Безье------------------------||
    </p>
</head>
<body>

<canvas id="canvas" width="500" height="500" style='border:5px solid #ff00ff'></canvas>
<script src='hw6.js'></script>

<script>

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var status = 0, kol = 0, points = [];

    function drawLine(ctx, x0, y0, x1, y1) {
        var xdir, ydir;
        var eps = 0;
        var k=2*Math.min(Math.abs(x1-x0), Math.abs(y1-y0));

        if (x1<x0)
            xdir = -1
        else
            xdir = 1;

        if (y1<y0)
            ydir = -1
        else
            ydir = 1;

        if (Math.abs(y1-y0)<=Math.abs(x1-x0)) {
            var y = y0;
            for (var x=x0; x*xdir<=x1*xdir; x+=xdir) {
                ctx.fillRect(x, y, 1, 1);
                eps = eps+k;
                if (eps>Math.max(Math.abs(x1-x0), Math.abs(y1-y0))) {
                    y+=ydir;
                    eps = eps - 2*Math.max(Math.abs(x1-x0), Math.abs(y1-y0));
                }
            }
        } else {
            var x = x0;
            for (var y=y0; y*ydir<=y1*ydir; y+=ydir) {
                ctx.fillRect(x, y, 1, 1);
                eps = eps+k;
                if (eps>Math.max(Math.abs(x1-x0), Math.abs(y1-y0))) {
                    x+=xdir;
                    eps = eps - 2*Math.max(Math.abs(x1-x0), Math.abs(y1-y0));
                }
            }
        }
    }

    function distance(P0, P1, P2){
        d = Math.abs(-(P2[1] - P0[1])/(P2[0] - P0[0])*P1[0] + P1[1] + (P2[1] - P0[1])/(P2[0] - P0[0])*P0[0] + P0[1])/
            Math.sqrt((P2[1] - P0[1])/(P2[0] - P0[0])*(P2[1] - P0[1])/(P2[0] - P0[0]) + 1);
        return d
    }

    function HalfDivizion1(P0, P1, P2){
        distance = Math.abs(-(P2[1] - P0[1])/(P2[0] - P0[0])*P1[0] + P1[1] + (P2[1] - P0[1])/(P2[0] - P0[0])*P0[0] + P0[1])/Math.sqrt((P2[1] - P0[1])/(P2[0] - P0[0])*(P2[1] - P0[1])/(P2[0] - P0[0]) + 1);
        if(distance > 1){
            P_ = [];
            P__ = [];
            P_[0] = 0.5*P0[0] + 0.5*P1[0];
            P_[1] = 0.5*P0[1] + 0.5*P1[1];
            P__[0] = 0.5*(0.5*P0[0] + 0.5*P1[0]) + 0.5*(0.5*P1[0] + 0.5*P2[0]);
            P__[1] = 0.5*(0.5*P0[1] + 0.5*P1[1]) + 0.5*(0.5*P1[1] + 0.5*P2[1]);
            drawLine(ctx, (0.5*P0[0] + 0.5*P1[0]), (0.5*P0[1] + 0.5*P1[1]),
                (0.5*P1[0] + 0.5*P2[0]), (0.5*P1[1] + 0.5*P2[1]));
            HalfDivizion1(P0, P_, P__);
        }else{
            drawLine(ctx, 0.5*P0[0] + 0.5*P1[0], 0.5*P0[1] + 0.5*P1[1],
                0.5*P1[0] + 0.5*P2[0], 0.5*P1[1] + 0.5*P2[1]);
        }
    }

    function HalfDivizion2(P0, P1, P2){
        distance = Math.abs(-(P2[1] - P0[1])/(P2[0] - P0[0])*P1[0] + P1[1] + (P2[1] - P0[1])/(P2[0] - P0[0])*P0[0] + P0[1])/Math.sqrt((P2[1] - P0[1])/(P2[0] - P0[0])*(P2[1] - P0[1])/(P2[0] - P0[0]) + 1);
        if(distance > 1){
            P_ = [];
            P_[0] = 0.5*P1[0] + 0.5*P2[0];
            P_[1] = 0.5*P1[1] + 0.5*P2[1];
            P__ = [];
            P__[0] = 0.5*(0.5*P0[0] + 0.5*P1[0]) + 0.5*(0.5*P1[0] + 0.5*P2[0]);
            P__[1] = 0.5*(0.5*P0[1] + 0.5*P1[1]) + 0.5*(0.5*P1[1] + 0.5*P2[1]);
            drawLine(ctx, 0.5*P0[0] + 0.5*P1[0], 0.5*P0[1] + 0.5*P1[1],
                0.5*P1[0] + 0.5*P2[0], 0.5*P1[1] + 0.5*P2[1]);
            HalfDivizion2(P__, P_, P2);
        }else{
            drawLine(ctx, 0.5*P0[0] + 0.5*P1[0], 0.5*P0[1] + 0.5*P1[1],
                0.5*P1[0] + 0.5*P2[0], 0.5*P1[1] + 0.5*P2[1]);
        }
    }

    canvas.addEventListener("click", function(foo){
        if (status == 0) {
            points[kol] = [foo.offsetX, foo.offsetY];
            status = 1;

        } else if (status == 1) {
            points[kol] = [foo.offsetX, foo.offsetY];
            drawLine(ctx, points[0][0], points[0][1], points[1][0], points[1][1]);
            status = 2;

        } else if (status == 2) {
            points[kol] = [foo.offsetX, foo.offsetY];
            drawLine(ctx, points[1][0], points[1][1], points[2][0], points[2][1]);
            status = -1;

        }else if(status == -1){
            status = -2;
            HalfDivizion1(points[0], points[1], points[2]);
            HalfDivizion2(points[0], points[1], points[2]);
        }else if(status == -2){
            status = 0;
            kol = -1;
            points = [];
        }
        kol += 1;
    });
</script>
</body>
</html>